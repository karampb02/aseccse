<!DOCTYPE html>
<html>
<head>
  <title>College Attendance Tracker - Section B</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; cursor: pointer; }
    button { margin: 5px; padding: 8px 12px; }
    tr.absent { background-color: #ffffff; }
    tr.present { background-color: #c8f7c5; }
  </style>
</head>
<body>

<h2>Attendance - Section B</h2>
<p id="date">Date:</p>
<p>Enter Subject Name: <input id="subject"/></p>
<table id="attendanceTable">
  <tr>
    <th>Roll No.</th>
    <th>Student Name</th>
  </tr>
</table>

<button onclick="promptForPDFExport()">Export as PDF</button>
<button onclick="resetAttendance()">Reset</button>

<div style="position:fixed; bottom:0; right:0; opacity: 0.5; text-align:right">Created by: Karamjit Singh<br>Avnoor Singh Bal</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  // Students for Section B
  const studentsRaw = [
    "LAKSHDEEP", "MALHAR", "MANASVI", "MANJOT", "MANJOT", "MANPAWAN", "MANPREET", "MANRAJDEEP", "MANTHAN",
    "MANTHAN", "MEHAK", "MEHAK", "MEHAKDEEP", "MEHAKPREET", "MEHAR", "MISHTHI", "MITHILESHWAR", "MOHIT",
    "MOHIT", "MOHIT", "MOULIK", "MR", "MRIDULA", "MUSKAN", "NANDANI", "NANDINI", "NAVDEEP", "NAVJIT",
    "NAVJOT", "NAVNEET", "NAVREET", "NAVYA", "NEELESH", "NIMISH", "NIRJALA", "NITISH", "PALAK",
    "PAVITERPREET", "PAVNEET", "PRABHNOOR", "PRABHNOOR", "PRANAV", "PRINCE", "PRITIKA", "PRIYANSH",
    "RAGHAV", "RAGHUNANDAN", "RAHUL", "RANVIR", "RASHMITA", "RAVDEEP", "RAYAN", "REHAN", "RIDHAMPREET",
    "RISHITA", "RIVANSHU", "ROHINI", "ROHIT", "ROOPANSHI", "RUDRAKSH", "RUDRAKSH", "RUHI", "SACHIN",
    "SAHEJVEER", "SAHIBPREET", "SAHIL", "SAKSHAM", "SAMAIRA", "SAMRIDHI", "SANCHI", "SANYAM", "SATYAK",
    "SAWAL", "SAWNI", "SHAGUN", "SHASHANK", "SHATRUNJAY", "SHAURYA", "SHIVANG", "SHIVANSH", "SHIVJOT",
    "SHREYANSH", "SIDARTH", "SIRTAJ", "SIYA", "SOURAV", "SUKHMANI", "SUKHMANJEET", "SUKHMANPREET",
    "SUKHPAL", "SUNAKSHI", "SUNDRAM", "SUNIDHI", "SURYA", "SUSHANK", "SUSHEN", "TANDRIKA", "TANMYA",
    "TEJ", "TRIBHUVAN", "TUSHAAR", "UJWAL", "UTTAMPREET", "VAIBHAV", "VAISHALI", "VARENYA", "VARUN",
    "VENU", "VINEET", "VINOD", "VISHAL", "VISHESH", "YASHIKA", "YOGITA", "YUVRAJ", "JATIN"
  ];

  const nameCount = {};
  studentsRaw.forEach(name => { nameCount[name] = (nameCount[name] || 0) + 1; });
  const dupSeen = {};
  const students = studentsRaw.map(name => {
    if (nameCount[name] === 1) { return [name]; }
    else { dupSeen[name] = (dupSeen[name] || 0) + 1; return [`${name} (${dupSeen[name]})`]; }
  });

  const dateObj = new Date();
  const y = dateObj.getFullYear();
  const m = dateObj.getMonth()+1;
  const d = dateObj.getDate();
  document.getElementById("date").innerHTML += `${d}/${m}/${y}`;

  const table = document.getElementById("attendanceTable");
  students.forEach(([name], index) => {
    const row = table.insertRow();
    row.insertCell().textContent = index + 1;
    row.insertCell().textContent = name;
    row.classList.add("absent");
    row.addEventListener("click", () => {
      row.classList.toggle("present");
      row.classList.toggle("absent");
    });
  });

  function getPresent() {
    return Array.from(table.rows).slice(1)
      .filter(row => row.classList.contains("present"))
      .map(row => `${row.cells[0].textContent}. ${row.cells[1].textContent}`);
  }

  function getAbsent() {
    return Array.from(table.rows).slice(1)
      .filter(row => row.classList.contains("absent"))
      .map(row => `${row.cells[0].textContent}. ${row.cells[1].textContent}`);
  }
  
  function promptForPDFExport() {
    const password = prompt("Please enter the password to export as PDF:");
    if (password === "@exportPDF") {
      exportPDF();
    } else if (password !== null) {
      alert("Incorrect password.");
    }
  }

  function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const present = getPresent();
    const absent = getAbsent();
    const pageHeight = doc.internal.pageSize.getHeight();
    const pageWidth = doc.internal.pageSize.getWidth();
    let yPos = 30;
    const lineHeight = 7;

    doc.setTextColor(0, 0, 0);
    doc.text("Subject: " + document.getElementById("subject").value, 10, 10);
    doc.text(("Date: " + d + "/" + m + "/" + y), 10, 17);
    doc.text(`Present: ${present.length}, Absent: ${absent.length}, Total: ${students.length}`, 10, 24);

    doc.text("Present Students:", 10, yPos); yPos += lineHeight;
    doc.setTextColor(0, 128, 0);
    present.forEach(line => {
      if (yPos > pageHeight - 20) { doc.addPage(); yPos = 20; }
      doc.text(line, 10, yPos); yPos += lineHeight;
    });

    yPos += lineHeight;
    doc.setTextColor(0, 0, 0);
    doc.text("Absent Students:", 10, yPos); yPos += lineHeight;
    doc.setTextColor(255, 0, 0);
    absent.forEach(line => {
      if (yPos > pageHeight - 20) { doc.addPage(); yPos = 20; }
      doc.text(line, 10, yPos); yPos += lineHeight;
    });

    doc.setTextColor(0, 0, 0);
    const watermarkText = "Created by: Karamjit Singh, Avnoor Singh Bal";
    doc.setFontSize(10);
    const textWidth = doc.getTextWidth(watermarkText);
    doc.text(watermarkText, pageWidth - textWidth - 10, pageHeight - 10);

    doc.save("attendance.pdf");
  }

  function resetAttendance() {
    Array.from(table.rows).slice(1).forEach(row => {
      row.classList.remove("present");
      row.classList.add("absent");
    });
  }
</script>
</body>
</html>